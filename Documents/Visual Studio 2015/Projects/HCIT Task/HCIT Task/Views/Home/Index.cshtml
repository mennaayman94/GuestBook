
@{
    Layout = null;
    //using (Html.BeginForm("Index","Home",FormMethod.po))
}


<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Image Editor</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2/fabric.min.js">
       

    </script> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link href="~/Index.css" rel="stylesheet" />
  
</head>

<body >
  <div style="width:100%;height:100%; background-color:azure;">
      <div style="width:100%; height:20%" ;>
          <nav class="navbar navbar-expand-lg navbar-light bg-light">
              <a class="navbar-brand" href="#">Image Editor</a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNavDropdown">
                  <ul class="navbar-nav">
                      <li class="nav-item active">
                          <a class="btn btn-outline-primary" href="#">Home <span class="sr-only">(current)</span></a>
                      </li>
                      <li class="nav-item">
                          <button class="btn btn-outline-primary" type="button" id="inputGroupFileAddon04" onclick="addText()">Add Text</button>
                      </li>
                      
                      <li class="nav-item dropdown">
                          <select class="custom-select" id="font" style="background-color:transparent;">
                              <option selected>Select your favourite font</option>
                              <option >Arial</option>
                              <option >Tahoma</option>
                              <option >Time New Roman</option>
                          </select>
                      </li>
                      
                     
                  </ul>
                  
              </div>
              <div class="select">
                  <span>Choose your favourite color</span>
                  <input type="color" value="blue" id="fill" />

              </div>
          </nav>
      </div>
      <div class="input-group" style="width:60%; margin-left:20%; padding-top:10px" >
          <div class="custom-file">

              <input type="file" class="custom-file-input" name="imgfile" id="file" aria-describedby="inputGroupFileAddon04">
              <label class="custom-file-label" for="inputGroupFile04">Choose file</label>
          </div>

          <div class="input-group-append">
              <button class="btn btn-outline-primary" type="button" id="inputGroupFileAddon04" onclick="addText()">Add Text</button>
              <a class="btn btn-outline-success" id="download" download="myImage.jpg"  onclick="download_img(this);" href="" role="button">Download Your Image</a>

              

          </div>
          </div>
      <div class="canvasclass">
          <canvas id="canvas" width="1000" height="800" style="border: 1px solid black"></canvas>


      </div>
      </div>
    <script>
        var canvas = new fabric.Canvas('canvas');

        document.getElementById('file').addEventListener("change", function (e) {
            var file = e.target.files[0];
            var reader = new FileReader();
            console.log("reader   " + reader);
            reader.onload = function (f) {
                var data = f.target.result;
                fabric.Image.fromURL(data, function (img) {
                    var oImg = img.set()
                    canvas.add(oImg).renderAll();
                    canvas.setActiveObject(oImg);
                });
            };
            reader.readAsDataURL(file);
        });

        $('#fill').change(function () {
            var obj = canvas.getActiveObject();

            if (obj) {
                // old api
                // obj.setFill($(this).val());
                obj.set("fill", this.value);
            }
            canvas.renderAll();
        });

        

        

        function addText() {
            var oText = new fabric.IText('Tap and Type', {
                left: 100,
                top: 100,
            });
        

           canvas.add(oText);
            oText.bringToFront();
           canvas.setActiveObject(oText);
           $('#fill, #font').trigger('change');
       
        }
        $('#font').change(function () {
            var obj = canvas.getActiveObject();

            if (obj) {
                 //old api
                //obj.setFontFamily($(this).val());
                obj.set("fontFamily", this.value);
            }

            canvas.renderAll();
        });
        download_img = function (el) {
            // get image URI from canvas object
            var imageURI = canvas.toDataURL("image/jpg");
            el.href = imageURI;
        };
        
    </script>
</body>
</html>
